프로그램 요구사항

매수 대상 종목 선택

매수 대상 종목은 입력 UI를 통해 설정 가능해야 합니다.

최대 200개 종목까지 매수 대상으로 등록할 수 있어야 합니다.

자동 매수 실행

선택된 종목들 중, 조건을 만족하면 자동으로 매수가 실행되어야 합니다.
조건:

20일 이동평균선 대비 −19% 가격 도달 시

일봉 차트 기준 Envelope(기간 20, 퍼센트 20) 하단 지지선 기준

세부 조건:
2-1. 매수 금액은 사용자 설정이 가능해야 합니다.

2-2.

가격이 20일 이동평균선 대비 −19%에 도달하면,

해당 종목의 일봉 Envelope(기간 20, 퍼센트 20) 하단 지지선 가격에 지정가 매수 주문을 제출해야 합니다.

실제 매수 주문 가격은 지지선 가격보다 1틱 위의 가격이어야 합니다.

2-3.

미체결 매수 주문이 남아 있는 상태에서,

해당 종목의 보유 물량 중 일부라도(자동/수동 상관없이) 매도가 체결되면,

남아 있는 모든 미체결 매수 주문은 즉시 취소되어야 합니다.

분할(다단계) 매수 (최대 3차까지)

매수는 최대 3단계로 진행됩니다.

1차 매수

1차 매수 체결가 대비 −10%에서 2차 매수

2차 매수 체결가 대비 −10%에서 3차 매수
(매도 로직은 평단가 기준이며, 4번 항목 참조)

3-1.

2-1에서 설정한 매수 금액이 있다면,

1차, 2차, 3차 매수 모두 동일한 금액으로 매수해야 합니다.

3-2.

자동 매수 과정 중 한 번이라도 매도 체결이 발생하면,

남아 있는 2차, 3차 자동 매수 주문은 모두 취소되어야 합니다.

매도 전략

매도는 “평균 매수가(평단)” 기준으로 실행됩니다.

평단 대비 +2.95% 도달 시: 보유 수량의 30% 매도

평단 대비 +4.95% 도달 시: 추가 30% 매도

평단 대비 +6.95% 도달 시: 추가 30% 매도

20일 이동평균선 가격 도달 시: 남은 10% 전량 매도

추가 조건:

한 번이라도 매도가 체결된 이후에는,

이후에 가격이 다시 평단가까지 떨어지면 손절(손절매)이 발동되어야 합니다(5번 항목 참조).

손절(스톱로스) 로직

첫 번째 매도가 발생한 시점부터,

평단가에 손절 라인이 활성화됩니다.

이후 가격이 평단가로 되돌아오면, 손절 매도를 실행해야 합니다.

수동 개입 (UI 요구사항)

매수/매도는 기본적으로 자동으로 수행됩니다.
다만 아래와 같은 경우에는 수동 매도가 가능해야 합니다.

재량에 의한 조기 손절

급등 시 더 높은 가격에서의 재량 매도

UI에는 다음 기능이 포함되어야 합니다.

“해당 종목 모든 주문 취소” 버튼

수동 매도 입력 항목:

매도가격

매도 비율(%)

최대 보유 종목 수

사용자가 동시에 보유할 수 있는 최대 종목 수를 설정할 수 있어야 합니다.
(예: “3”으로 설정하면, 최대 3개 종목까지 동시 보유)

7-1.

특정 종목이 매수 대상으로 선택되어 있더라도,

현재 보유 종목 수가 최대값에 도달한 경우,

추가 자동 매수는 허용되지 않아야 합니다.

7-2.

이미 보유 중인 종목에 대해서는 자동 매수/매도 로직이 정상적으로 계속 동작해야 합니다.

하지만, 보유 종목 수가 최대치(예: 3)에 도달한 상태에서는:

아직 보유하지 않은 종목에 대한 모든 미체결 매수 주문을 취소해야 하며,

해당 종목들에 대해서는 추가 매수가 이루어져서는 안 됩니다.

상태 저장(영속성) 로직

시스템은 다음 정보를 조회 및 저장할 수 있어야 합니다.

현재 보유 종목 및 수량

평균 매수가(평단가)

보유 수량

당일(및 과거) 매매 이력

미체결 주문 목록

종목별 상태 추적

각 종목에 대해 다음 상태를 유지해야 합니다.

현재까지 완료된 매수 단계 (1차 / 2차 / 3차 중 어디까지 체결되었는지)

이미 실행된 매도 구간:

+2.95% 구간 매도 여부

+4.95% 구간 매도 여부

+6.95% 구간 매도 여부

20일 이동평균선 매도 여부

첫 매도가 발생했는지 여부(즉, 손절 모드가 활성화되었는지 여부)

필요 동작 (상태 복원 및 연속성)

매매가 여러 거래일에 걸쳐 진행될 수 있으므로, 다음 요구사항을 만족해야 합니다.

프로그램이 중지되거나 재시작되더라도,

이전의 모든 매매 상태를 복원해야 합니다.

자동 매수/매도 동작이 중단 지점부터 자연스럽게 이어져야 합니다.

프로그램 재시작 시:

현재 계좌 상태를 반드시 확인해야 합니다.

프로그램이 꺼져 있는 동안 일부 종목이 이미 전량 또는 일부 매도되었을 수 있기 때문입니다.

실제 체결 이력을 기반으로 다음을 판단해야 합니다.

추가 매수가 가능한지 여부

추가 매도가 발생해야 하는지 여부

그 판단을 바탕으로 자동 매수/매도 로직을 다시 이어서 수행해야 합니다.

거래일 변경(장 개시) 시:

전일의 주문들은 거래소 기준으로 자동 취소 상태가 됩니다.

이때 시스템은 다음을 수행해야 합니다.

마지막으로 기록된 주문/체결 상태를 복원

필요한 주문들을 재생성

자동 매수/매도 로직을 중단 없이 그대로 이어서 수행

전일에 매도 조건이 충족되지 않았다면,

새로운 거래일에도 동일한 전략이 연속적으로 유지되어야 합니다.




환경 구성 참고
https://blog.naver.com/wraith_03/224112168897


https://www.kiwoom.com/h/customer/download/VOpenApiInfoView


pip install pyqt5==5.15.9 
키움에서 제일 안정적인버전